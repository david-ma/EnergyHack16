<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Ignite</title>

<style>

</style>
</head>
<body>
	<header>
		<div class="blur_background">
			<div class="mask"></div>
		</div>
		<div class="container">
			<div class="row">
				<div class="col-xs-12">
					<h1>Ignite</h1>
					<h2>A smartphone app to help you save energy, built for #EnergyHack16</h2>
				</div>
			</div>
		</div>
	</header>

	<div class="container page">

		<!--<div class="row">-->
			<!--<div class="col-xs-12">-->
			<!--<h1>-->
				<!--Sup?-->
			<!--</h1>-->
		<!--<p>Hey this is a stupid example index.html</p>-->
		<!--<p>Run "npm test example" from the thalia root to develop</p>-->
		<!--<p>Except, put the workspace you want in the place of example...</p>-->
		<!--<p>Don't forget to npm install, bower install, and gulp build if you're into that stuff.</p>-->
			<!--</div>-->
		<!--</div>-->

			<!--<h2>Ok here's some dummy text:</h2>-->
<br>
<div class="row">
		<label for="postcode">Enter a Postcode:<input id="postcode" autofocus maxlength=4 placeholder="Postcode" type="text" /></label>
</div>


		<div class="row">

			<div class="col-xs-12 col-sm-6">
				<span id="map-span"><div id="map-div"></div></span>
			</div>

			<div class="col-xs-12 col-sm-6">
				<p>Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. Some sort of text goes here. </p>
				<span id="donut-span"><div id="donut-div"></div></span>
			</div>
		</div>
	</div>

	<footer>
		<div class="container">
			<div class="row">
				<p class="col-xs-6">Simple <a href="https://github.com/david-ma/Thalia">Thalia</a> Bootstrap Boilerplate</p>
				<p class="col-xs-6 text-right">By <a href="https://twitter.com/frostickle">@Frostickle</a> <i class="fa fa-twitter" aria-hidden="true"></i></p>
			</div>
		</div>
	</footer>
	<link rel="stylesheet" href="/css/main.css">
	<script src="/js/vendor.min.js"></script>
	<script src="/js/scripts.min.js"></script>
	<!--<script src="//d3js.org/topojson.v1.min.js"></script>-->


	<!-- For the postcode data, we need to use topojson v0 -->
	<!--<script src="http://d3js.org/d3.v3.min.js"></script>-->
	<script src="http://d3js.org/topojson.v0.min.js"></script>




<script>
	var width = 750,
		height = 700;

	var map_svg = d3.select("#map-div")
			.append("svg")
			.attr("id", "map-svg")
			.attr("viewBox", "0 0 750 750")
			.attr("width", width)
			.attr("height", height + 50);

	var g = map_svg.append("g")
			.attr("transform", "translate(0, 50)")
			.append("g");

	var color = d3.scale.category10();
	var loading = map_svg.append("text")
			.attr("x", width / 2)
			.attr("y", height / 2)
			.attr("dy", ".35em")
			.attr("text-anchor", "middle")
			.style("font-size", 40)
			.text("Loading...");

	d3.json("/data/postcodes.json", function(error, postcodes) {
		var postcodesgeo = topojson.object(postcodes, postcodes.objects.postcodesgeo).geometries;
		var mainlandWidth = 236;
		var leftMargin = 186;
		var rightMargin = 64;
		var allAus = mainlandWidth + leftMargin + rightMargin;
		var translateWidth = width / (allAus / mainlandWidth);
		var projection = d3.geo.albers()
				.translate([translateWidth, height / 2])
				.scale(1100)
				.rotate([-132.5, 0])
				.center([0, -26.5]) // Center of Australia, accounting for tasmania
				.parallels([-36, -18]);
		var path = d3.geo.path()
				.projection(projection);
		var input = d3.select("input")
				.on("cut", change)
				.on("paste", change)
				.on("change", change)
				.on("keyup", change);
		var feature = g.selectAll("path")
				.data(postcodesgeo)
				.enter().append("path")
				.attr("class", "feature")
				.attr("d", path);
		loading.remove();

//	This is for the legend...
//		svg.append("rect")
//				.attr("x", 0)
//				.attr("y", 0)
//				.attr("height", 50)
//				.attr("width", width)
//				.style("fill", "white");
//		svg.append("line")
//				.attr("class", "divider")
//				.attr("x1", 0)
//				.attr("x2", width)
//				.attr("y1", 51)
//				.attr("y2", 51);

		var legends = map_svg.append("g").attr("class", "legends");
		map_svg.selectAll("text.legend")
				.data([0,1,2,3,4,5,6,7,8,9])
				.enter().append("text")
				.attr("class", "legend")
				.attr("y", 25)
				.attr("x", function(d) { return width - (10 - d) * 50 + 25; })
				.style("fill", "white")
				.attr("dy", ".35em")
				.attr("text-anchor", "middle")
				.style("font-size", 20)
				.text(String);

		var prefix = "POA";
		var selectedPostcode;
		change();
		function updateLegend(legend) {
			var container = legends.selectAll("rect.legend")
					.data(legend, function(d) { return d; });
			container
					.transition().duration(750)
					.attr("x", function(d) { return width - (10 - d) * 50; })
					.style("fill", function(d) { return color(d); })
					.attr("y", 0);
			container.enter().append("rect")
					.attr("class", "legend")
					.attr("y", -50)
					.attr("width", 50)
					.attr("height", 50)
					.attr("x", function(d) { return width - (10 - d) * 50; })
					.transition()
					.duration(750)
					.ease("bounce")
					.style("fill", function(d) { return color(d); })
					.attr("y", 0);
			container.exit().transition().duration(400)
					.ease("backs")
					.attr("y", -50)
					.remove();
		}
		function setFoundStyle(selection, postcode) {
			selection.style("fill", color(postcode.slice(-1)));
		}
		function unzoom(selection) {
			selection.transition().duration(750).attr("transform", "");
		}
		function zoom(selection, b, maxScale) {
			var scale = 0.95 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height);
			var usedScale = Math.min(scale, maxScale);
			selection.transition().duration(750).attr("transform",
					"translate(" + projection.translate() + ")" +
					"scale(" + usedScale + ")" +
					"translate(" + -(b[1][0] + b[0][0]) / 2 + "," + -(b[1][1] + b[0][1]) / 2 + ")");
		}


		function change() {
			var lastPostcode = selectedPostcode;
			selectedPostcode = input.property("value");
			if (lastPostcode === selectedPostcode) {
				return;
			}
			var shouldUnzoom = selectedPostcode === "";
			var shouldZoom = selectedPostcode.match(/\d{1,4}/);
			if (!shouldUnzoom && !shouldZoom) {
				return;
			}
			var matchString = prefix + selectedPostcode;
			var findBounds = findMinMaxBounds();
			var bounds;
			var legendObj = {};
			var matching = feature.filter(function(d) {
				var match = matchingFeature(d, matchString);
				var next = nextDigit(d, matchString);
				this.style.fill = match ? color(+next) : "#222";
				if (match) {
					if (next) { legendObj[+next] = true; }
					bounds = findBounds(path.bounds(d));
				}
				return match;
			});
			updateLegend(d3.keys(legendObj).map(function(d) { return +d; }));
			if (matching[0].length === 0) { return; }
			if (selectedPostcode.length === 4 && matching[0].length === 1) { matching.call(setFoundStyle, matchString); }
			var zoomers = function() {
				if (shouldZoom) { g.call(zoom, bounds, 100); }
				if (shouldUnzoom) { g.call(unzoom); }
			};
			setTimeout(zoomers, 0);
		}


		function nextDigit(feature, string) {
			return feature.id.charAt(string.length);
		}
		function matchingFeature(feature, string) {
			return feature.id.indexOf(string) !== -1;
		}
		function findMinMaxBounds() {
			var topBound    = -Infinity;
			var rightBound  = -Infinity;
			var bottomBound =  Infinity;
			var leftBound   =  Infinity;
			return function (bound) {
				leftBound = Math.min(bound[0][0], leftBound);
				bottomBound = Math.min(bound[0][1], bottomBound);
				rightBound = Math.max(bound[1][0], rightBound);
				topBound = Math.max(bound[1][1], topBound);
				return [[leftBound, bottomBound], [rightBound, topBound]];
			};
		}
	});
	d3.select(self.frameElement).style("height", height + "px");






// Donut stuff:

	var donut_svg = d3.select("#donut-div")
			.append("svg")
			.attr("height", 280)
			.attr("width", 400)
			.attr("viewBox", "0 0 200 450")
			.append("g");

	donut_svg.append("g")
			.attr("class", "slices");
	donut_svg.append("g")
			.attr("class", "labels");
	donut_svg.append("g")
			.attr("class", "lines");

	var donut_width = 960,
		donut_height = 450,
		radius = Math.min(donut_width, donut_height) / 2;

	var pie = d3.layout.pie()
			.sort(null)
			.value(function(d) {
				return d.value;
			});

	var arc = d3.svg.arc()
			.outerRadius(radius * 0.8)
			.innerRadius(radius * 0.4);

	var outerArc = d3.svg.arc()
			.innerRadius(radius * 0.9)
			.outerRadius(radius * 0.9);

	donut_svg.attr("transform", "translate(100,225)");

	var key = function(d){ return d.data.label; };

	var donut_color = d3.scale.ordinal()
			.domain(["Lorem ipsum", "dolor sit", "amet", "consectetur", "adipisicing", "elit", "sed", "do", "eiusmod", "tempor", "incididunt"])
			.range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

	function randomData (){
		var labels = donut_color.domain();
		return labels.map(function(label){
			return { label: label, value: Math.random() }
		});
	}

	change(randomData());

	d3.select(".randomize")
			.on("click", function(){
				change(randomData());
			});


	function change(data) {

		/* ------- PIE SLICES -------*/
		var slice = donut_svg.select(".slices").selectAll("path.slice")
				.data(pie(data), key);

		slice.enter()
				.insert("path")
				.style("fill", function(d) { return donut_color(d.data.label); })
				.attr("class", "slice");

		slice
				.transition().duration(1000)
				.attrTween("d", function(d) {
					this._current = this._current || d;
					var interpolate = d3.interpolate(this._current, d);
					this._current = interpolate(0);
					return function(t) {
						return arc(interpolate(t));
					};
				})

		slice.exit()
				.remove();

		/* ------- TEXT LABELS -------*/

		var text = donut_svg.select(".labels").selectAll("text")
				.data(pie(data), key);

		text.enter()
				.append("text")
				.attr("dy", ".35em")
				.text(function(d) {
					return d.data.label;
				});

		function midAngle(d){
			return d.startAngle + (d.endAngle - d.startAngle)/2;
		}

		text.transition().duration(1000)
				.attrTween("transform", function(d) {
					this._current = this._current || d;
					var interpolate = d3.interpolate(this._current, d);
					this._current = interpolate(0);
					return function(t) {
						var d2 = interpolate(t);
						var pos = outerArc.centroid(d2);
						pos[0] = radius * (midAngle(d2) < Math.PI ? 1 : -1);
						return "translate("+ pos +")";
					};
				})
				.styleTween("text-anchor", function(d){
					this._current = this._current || d;
					var interpolate = d3.interpolate(this._current, d);
					this._current = interpolate(0);
					return function(t) {
						var d2 = interpolate(t);
						return midAngle(d2) < Math.PI ? "start":"end";
					};
				});

		text.exit()
				.remove();

		/* ------- SLICE TO TEXT POLYLINES -------*/

		var polyline = donut_svg.select(".lines").selectAll("polyline")
				.data(pie(data), key);

		polyline.enter()
				.append("polyline");

		polyline.transition().duration(1000)
				.attrTween("points", function(d){
					this._current = this._current || d;
					var interpolate = d3.interpolate(this._current, d);
					this._current = interpolate(0);
					return function(t) {
						var d2 = interpolate(t);
						var pos = outerArc.centroid(d2);
						pos[0] = radius * 0.95 * (midAngle(d2) < Math.PI ? 1 : -1);
						return [arc.centroid(d2), outerArc.centroid(d2), pos];
					};
				});

		polyline.exit()
				.remove();
	};











</script>




















</body>
</html>





