<!DOCTYPE html>
<meta charset="utf-8">
<style>
	text, label {
		font-family: sans-serif;
	}
	label {
		position: absolute;
		text-align: center;
		font-weight: bold;
		padding: 0 10px;
		line-height: 50px;
	}
	input {
		text-align: center;
		width: 5em;
		padding: 5px;
	}
	.feature {
		stroke: none;
	}
	.divider {
		stroke: #dedede;
		stroke-width: 0.5px;
	}
	.legend {
		display: none;
	}
</style>
<body>
<label for="postcode">
	Enter a Postcode:
	<input id="postcode" autofocus maxlength="4" placeholder="Postcode" type="text">
</label>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v0.min.js"></script>
<script>var width=750,height=700,svg=d3.select("body").append("svg").attr("width",width).attr("height",height+50),g=svg.append("g").attr("transform","translate(0, 50)").append("g"),color=d3.scale.category10(),loading=svg.append("text").attr("x",width/2).attr("y",height/2).attr("dy",".35em").attr("text-anchor","middle").style("font-size",40).text("Loading...");d3.json("/data/postcodes.json",function(t,e){function a(t){var e=b.selectAll("rect.legend").data(t,function(t){return t});e.transition().duration(750).attr("x",function(t){return width-50*(10-t)}).style("fill",function(t){return color(t)}).attr("y",0),e.enter().append("rect").attr("class","legend").attr("y",-50).attr("width",50).attr("height",50).attr("x",function(t){return width-50*(10-t)}).transition().duration(750).ease("bounce").style("fill",function(t){return color(t)}).attr("y",0),e.exit().transition().duration(400).ease("backs").attr("y",-50).remove()}function n(t,e){t.style("fill",color(e.slice(-1)))}function r(t){t.transition().duration(750).attr("transform","")}function i(t,e,a){var n=.95/Math.max((e[1][0]-e[0][0])/width,(e[1][1]-e[0][1])/height),r=Math.min(n,a);t.transition().duration(750).attr("transform","translate("+v.translate()+")scale("+r+")translate("+-(e[1][0]+e[0][0])/2+","+-(e[1][1]+e[0][1])/2+")")}function l(){var t=j;if(j=x.property("value"),t!==j){var e=""===j,l=j.match(/\d{1,4}/);if(e||l){var c,h=M+j,u=d(),f={},p=w.filter(function(t){var e=s(t,h),a=o(t,h);return this.style.fill=e?color(+a):"#222",e&&(a&&(f[+a]=!0),c=u(m.bounds(t))),e});if(a(d3.keys(f).map(function(t){return+t})),0!==p[0].length){4===j.length&&1===p[0].length&&p.call(n,h);var y=function(){l&&g.call(i,c,100),e&&g.call(r)};setTimeout(y,0)}}}}function o(t,e){return t.id.charAt(e.length)}function s(t,e){return t.id.indexOf(e)!==-1}function d(){var t=-(1/0),e=-(1/0),a=1/0,n=1/0;return function(r){return n=Math.min(r[0][0],n),a=Math.min(r[0][1],a),e=Math.max(r[1][0],e),t=Math.max(r[1][1],t),[[n,a],[e,t]]}}var c=topojson.object(e,e.objects.postcodesgeo).geometries,h=236,u=186,f=64,p=h+u+f,y=width/(p/h),v=d3.geo.albers().translate([y,height/2]).scale(1100).rotate([-132.5,0]).center([0,-26.5]).parallels([-36,-18]),m=d3.geo.path().projection(v),x=d3.select("input").on("cut",l).on("paste",l).on("change",l).on("keyup",l),w=g.selectAll("path").data(c).enter().append("path").attr("class","feature").attr("d",m);loading.remove(),svg.append("rect").attr("x",0).attr("y",0).attr("height",50).attr("width",width).style("fill","white"),svg.append("line").attr("class","divider").attr("x1",0).attr("x2",width).attr("y1",51).attr("y2",51);var b=svg.append("g").attr("class","legends");svg.selectAll("text.legend").data([0,1,2,3,4,5,6,7,8,9]).enter().append("text").attr("class","legend").attr("y",25).attr("x",function(t){return width-50*(10-t)+25}).style("fill","white").attr("dy",".35em").attr("text-anchor","middle").style("font-size",20).text(String);var j,M="POA";l()}),d3.select(self.frameElement).style("height",height+"px")</script>
</body>